const keystone = require('keystone');
const PrivacyPolicies = keystone.list('PrivacyPolicies');
const PrivacyContents = keystone.list('PrivacyContents');

updates = {
	privacy_policies: { stato: 'Attiva', nome: 'Privacy policy', key: 'privacy'},
	privacy_contents: [
		{ sortOrder: 1, titolo: 'Informativa sul trattamento dei dati personali degli utenti web ai sensi del regolamento UE 2016/679', testo: '<p>Nella presente informativa, resa in conformit&agrave; a quanto previsto dall&rsquo;art. 13 del Regolamento UE 2017/679 (GDPR) e dal D.lgs n. 196/2003 cos&igrave; come novellato dal D.lgs n. 101/2018, vengono descritte le operazioni effettuate sui dati personali degli utenti raccolti in occasione dell&rsquo;accesso, navigazione e fruizione del presente sito internet ([sito.url], di seguito il Sito) e non anche per altri siti <em>web</em> eventualmente consultati dall\'utente tramite <em>link</em> presenti nel sito stesso.</p>' },
		{ sortOrder: 2, titolo: 'Titolare del trattamento', testo: '<p><strong>[azienda.nome]</strong>&nbsp;(di seguito, <strong>[azienda.nome_breve]</strong>), con sede in [indirizzo.completo], <strong>[policies.titolare.email]</strong><em>, </em>&egrave; il <strong>Titolare del Trattamento</strong> dei dati personali degli utenti raccolti in occasione dell&rsquo;utilizzazione dei servizi del presente sito web. [azienda.nome_breve] tratter&agrave; i dati personali di cui entrer&agrave; in contatto nel rispetto dei principi di liceit&agrave;, correttezza e trasparenza nonch&eacute; delle disposizioni di legge e regolamenti per le seguenti finalit&agrave;:</p>\r\n<ul>\r\n<li>Accesso al sito internet e navigazione;</li>\r\n<li>Iscrizione alla newsletter di [azienda.nome_breve]:</li>\r\n<li>Richiesta di assistenza tecnica (Help Desk).</li>\r\n</ul>' },
		{ sortOrder: 3, titolo: 'Responsabile della protezione dati (RPD-DPO)', testo: '<p>Il Responsabile della Protezione dei Dati (RPD) &egrave; raggiungibile al seguente indirizzo:<br />[azienda.nome]. - Responsabile della Protezione dei Dati,&nbsp;<br />[indirizzo.completo] <br />e-mail:&nbsp;[policies.dpo.email]</p>' },
		{ sortOrder: 4, titolo: 'Luogo di trattamento dei dati', testo: '<p>I trattamenti connessi ai servizi web del presente Sito hanno luogo presso la menzionata sede legale del Titolare e presso la Societ&agrave; di hosting fornitrice del servizio con server ubicati in UE.</p>' },
		{ sortOrder: 5, titolo: 'Tipi di dati trattati', testo: '<p><strong><em>Dati di navigazione [test]</em></strong></p>\r\n<p>I sistemi informatici e le procedure <em>software</em> preposte al funzionamento di questo sito <em>web</em> acquisiscono, nel corso del loro normale esercizio, alcuni dati personali la cui trasmissione &egrave; implicita nell\'uso dei protocolli di comunicazione di Internet.</p>\r\n<p>Si tratta di informazioni che non sono raccolte per essere associate a interessati identificati, ma che per loro stessa natura potrebbero, attraverso elaborazioni ed associazioni con dati detenuti da terzi, permettere di identificare gli utenti.</p>\r\n<p>In questa categoria di dati rientrano gli indirizzi IP o i nomi a dominio dei computer utilizzati dagli utenti che si connettono al sito, gli indirizzi in notazione <em>URI (Uniform Resource Identifier)</em> delle risorse richieste, l\'orario della richiesta, il metodo utilizzato nel sottoporre la richiesta al server, la dimensione del file ottenuto in risposta, il codice numerico indicante lo stato della risposta data dal <em>server</em> (buon fine, errore, ecc.) ed altri parametri relativi al sistema operativo e all\'ambiente informatico dell\'utente.</p>\r\n<p>Questi dati vengono utilizzati al solo fine di ricavare <u>informazioni statistiche anonime sull\'uso del sito </u>e per controllarne il corretto funzionamento e vengono cancellati immediatamente dopo l\'elaborazione. I dati potrebbero essere utilizzati per l\'accertamento di responsabilit&agrave; in caso di reati informatici ai danni del sito o del Titolare: salva questa eventualit&agrave;, allo stato attuale, i dati sui contatti <em>web</em> non persistono oltre i termini di legge.</p>\r\n<p><strong><em>Dati forniti volontariamente dall\'utente</em></strong></p>\r\n<p>L\'invio facoltativo, specifico e volontario di posta elettronica agli indirizzi indicati in questo sito comporta la successiva acquisizione dell\'indirizzo del mittente da parte di [azienda.nome_breve], necessario per rispondere alle richieste, nonch&eacute; degli eventuali altri dati personali inseriti nella comunicazione.</p>\r\n<p>Specifiche informative di sintesi verranno riportate o visualizzate nelle pagine del sito predisposte per particolari servizi a richiesta.</p>' },
		{ sortOrder: 6, titolo: 'Cookies utilizzati dal sito web', testo: 'Per avere informazioni relative ai cookies utilizzati dal presente Sito &egrave; possibile consultare la seguente pagina: <a href="/[policies.cookie]">/[policies.cookie]</a>\r\n' },
		{ sortOrder: 7, titolo: 'Principi applicabili al trattamento dati da parte di [azienda.nome_breve]', testo: '<p>[azienda.nome_breve] tratter&agrave; i dati personali degli utenti in modo lecito, corretto e trasparente.</p>\r\n<p>Il Titolare raccoglier&agrave; i dati personali degli utenti e li tratter&agrave; unicamente per le finalit&agrave; indicate nella presente Privacy Policy ed in modo che non risultino incompatibili con le finalit&agrave; stesse.</p>\r\n<p>I dati trattati da [azienda.nome_breve] saranno adeguati, pertinenti e limitati a quanto necessario per le finalit&agrave; per cui sono trattati.</p>' },
		{ sortOrder: 8, titolo: 'Trattamento dei dati per finalità di iscrizione alla newsletter di [azienda.nome_breve]', testo: '<p>[azienda.nome_breve] tratter&agrave; i dati personali dell&rsquo;utente per consentirne l&rsquo;iscrizione alla newsletter informativa e promozionale via e-mail ed i relativi dati saranno registrati, custoditi ed utilizzati esclusivamente per promuovere l&rsquo;informazione, le iniziative, le attivit&agrave;, gli eventi ed i progetti di [azienda.nome_breve].</p>\r\n<p>La base giuridica di questo trattamento &egrave; il consenso dell&rsquo;interessato.</p>\r\n<p>Il conferimento dei dati per tale finalit&agrave; &egrave; facoltativo e i dati verranno trattati sino alla revoca del consenso (<em>opt-out</em>).</p>' },
		{ sortOrder: 9, stato: 'Non Attivo', titolo: 'Trattamento dei dati per la richiesta di assistenza tecnica (ticket)', testo: '<p>[azienda.nome_breve] tratter&agrave; i dati personali dell&rsquo;utente che compila l&rsquo;apposito form dell&rsquo;Help Desk di [azienda.nome_breve] per la richiesta di assistenza tecnica (ticket) per gestire, riscontrare e fornire il servizio richiesto all&rsquo;interessato utente web.</p>\r\n<p>I dati saranno registrati, custoditi ed utilizzati esclusivamente per gestire e riscontrare gli interessati sull&rsquo;assistenza tecnica richiesta, per il tempo necessario al raggiungimento della menzionata finalit&agrave;.</p>\r\n<p>La base giuridica di questo trattamento &egrave; l&rsquo;esecuzione di misure precontrattuali adottate su richiesta dell&rsquo;interessato ovvero l&rsquo;esecuzione di un contratto di cui l&rsquo;interessato stesso &egrave; parte.</p>\r\n<p>Il conferimento dei dati per tale finalit&agrave; di trattamento &egrave; facoltativo. Tuttavia, il mancato, parziale o inesatto conferimento dei dati potr&agrave; comportare l&rsquo;impossibilit&agrave; per [azienda.nome_breve] di gestire e dare seguito alle richieste di assistenza degli utenti.</p>' },
		{ sortOrder: 10, titolo: 'Social plug-in', testo: '<p>Il presente sito web pu&ograve; utilizzare i c.d. &ldquo;<em>social plug-in</em>&rdquo;.</p>\r\n<p>I &ldquo;<em>social plug-in</em>&rdquo; sono specifici strumenti che permettono di incorporare le funzionalit&agrave; del <em>Social Network</em> direttamente all&rsquo;interno del sito web.</p>\r\n<p>Tutti i &ldquo;<em>social plug-in</em>&rdquo; presenti nel sito sono contrassegnati dal rispettivo logo di propriet&agrave; della piattaforma di social network.</p>\r\n<p>Quando si visita una pagina del nostro sito e si interagisce con il &ldquo;<em>plug-in</em>&rdquo; o si decide di lasciare un commento attraverso la piattaforma Social, le corrispondenti informazioni vengono trasmesse dal <em>browser</em> direttamente alla piattaforma social di riferimento e da questa memorizzate.</p>\r\n<p>Per informazioni sulle finalit&agrave;, il tipo e le modalit&agrave; di raccolta, elaborazione, utilizzo e conservazione dei dati personali da parte della piattaforma di <em>Social Network</em>, nonch&eacute; per le modalit&agrave; attraverso cui esercitare i propri diritti, si prega di consultare la specifica <em>Privacy Policy</em> del <em>Social Network</em>.</p>\r\n\r\n<ul>\r\n<li><strong>Facebook </strong>(<span><a href="https://it-it.facebook.com/policy.php">https://it-it.facebook.com/policy.php</a></span>)</li>\r\n<li><strong>Twitter</strong> (<span><a href="https://twitter.com/it/privacy">https://twitter.com/it/privacy</a></span>)</li>\r\n<li><strong>Instagram</strong> (<span><a href="https://help.instagram.com/155833707900388">https://help.instagram.com/155833707900388</a></span>)</li>\r\n<li><strong> </strong><strong>YouTube (</strong><span><a href="https://www.youtube.com/intl/it/yt/about/policies/#community-guidelines">https://www.youtube.com/intl/it/yt/about/policies/#community-guidelines</a></span><strong>) </strong></li>\r\n<li><strong> </strong><strong>Linkedin</strong> (<span><a href="https://www.linkedin.com/legal/privacy-policy">https://www.linkedin.com/legal/privacy-policy</a></span><strong>)</strong></li>\r\n</ul>' },
		{ sortOrder: 11, titolo: 'Google Maps', testo: '<p>Il sito utilizza il plug-in di Google Maps.</p>\r\n<p>Si tratta di un servizio fornito da Google LLC (&ldquo;Google&rdquo;) per includere mappe interattive all&rsquo;interno delle pagine web. Tale servizio, in base alle impostazioni dell&rsquo;account dell&rsquo;interessato, pu&ograve; eseguire trattamenti di dati personali di quest&rsquo;ultimo, ivi inclusa la localizzazione geografica dell&rsquo;utente.</p>\r\n<p>Per consultare l&rsquo;informativa privacy della societ&agrave; Google LLC e per disattivare la funzione di localizzazione del proprio browser si rinvia al seguente link:</p>\r\n<p><span><a href="https://policies.google.com/technologies/location-data?hl=it">https://policies.google.com/technologies/location-data?hl=it</a></span>.</p>' },
		{ sortOrder: 12, titolo: 'Modalità di trattamento ', testo: '<p>I dati personali sono e saranno trattati con strumenti automatizzati per il tempo strettamente necessario a conseguire gli scopi per cui sono stati raccolti. I dati sono trattati da personale tecnico autorizzato al trattamento, debitamente istruito da parte di [azienda.nome_breve].</p>\r\n<p>Specifiche misure di sicurezza sono osservate per prevenire la perdita dei dati, usi illeciti o non corretti ed accessi non autorizzati.</p>' },
		{ sortOrder: 13, titolo: 'Categorie di soggetti a cui i dati possono essere comunicati (destinatari)', testo: '<p>I soggetti a cui [azienda.nome_breve] comunica i dati agiscono in qualit&agrave; di Responsabili del trattamento dei dati personali designati dal Titolare tramite apposito contratto o in qualit&agrave; di persone autorizzate al trattamento di dati personali sotto l&rsquo;autorit&agrave; diretta del Titolare.</p>\r\n<p><strong>I dati oggetto di trattamento non saranno in nessun caso diffusi. </strong></p>\r\n<p><strong>L&rsquo;interessato utente pu&ograve; richiedere la lista completa di destinatari scrivendo una e-mail a [policies.titolare.email]</strong></p>' },
		{ sortOrder: 14, titolo: 'Diritti degli interessati ', testo: '<p>Gli interessati utenti del Sito hanno il diritto di:</p>\r\n<ul>\r\n<li><strong>Richiesta di accesso ai dati personali</strong>: l&rsquo;utente ha il diritto di ottenere dal Titolare del trattamento la conferma che sia o meno in corso un trattamento di dati personali che lo riguardano e, in tal caso, l&rsquo;accesso ai dati stessi. L&rsquo;accesso pu&ograve; essere vertere sulle seguenti informazioni:\r\n<ul>\r\n<li>Le finalit&agrave; di trattamento;</li>\r\n<li>Le categorie di dati personali in questione;</li>\r\n<li>I destinatari o le categorie di destinatari a cui i dati sono stati o saranno comunicati, in particolare se destinati a paesi terzi o organizzazioni internazionali;</li>\r\n<li>Il perdio di conservazione dei dati personali ovvero i criteri utilizzati per determinare tale periodo;</li>\r\n<li>L&rsquo;esistenza del diritto di richiedere al Titolare la rettifica o la cancellazione dei dati ovvero la limitazione del trattamento o l&rsquo;opposizione allo stesso;</li>\r\n<li>L&rsquo;esistenza di un processo decisionale automatizzato.</li>\r\n</ul>\r\n</li>\r\n<li><strong>Richiesta di rettifica dei dati personali</strong>: l&rsquo;interessato ha il diritto ad ottenere la rettifica dei dati personali inesatti che lo riguardano, nonch&eacute; di ottenere l&rsquo;integrazione dei dati personali incompleti.</li>\r\n<li><strong>Richiesta di cancellazione dei dati personali</strong>: per i motivi indicati nell&rsquo;art. 17 GDPR, l&rsquo;interessato ha il diritto di richiedere al Titolare del trattamento la cancellazione dei dati senza ingiustificato ritardo ed il Titolare ha l&rsquo;obbligo di cancellare i dati personali dell&rsquo;interessato.</li>\r\n<li><strong>Richiesta di limitazione del trattamento dati</strong>: nel caso ricorra una delle ipotesi di cui all&rsquo;art. 18 GDPR, l&rsquo;interessato ha il diritto di richiedere la limitazione del trattamento dati che lo riguardano.</li>\r\n<li><strong>Richiesta di portabilit&agrave; dei dati</strong>: l&rsquo;interessato ha diritto di ricevere in un formato strutturato, di uso comune e leggibile, i dati personali che lo riguardano forniti ad un Titolare ed ha il diritto di trasmettere tali dati ad un altro Titolare del trattamento qualora il trattamento si sia basato sul consenso e sia effettuato con mezzi automatici.</li>\r\n<li><strong>Richiesta di opposizione al trattamento</strong>: l&rsquo;interessato ha il diritto di opporti al trattamento dei dati personali che lo riguardano in qualsiasi momento, per motivi connessi alla propria situazione particolare.</li>\r\n</ul>\r\n<p>L&rsquo;interessato ha altres&igrave; diritto di proporre reclamo all&rsquo;Autorit&agrave; italiana Garante per la protezione dei dati personali.</p>\r\n<p>Le richieste per l&rsquo;esercizio dei diritti possono essere rivolte a <strong>[policies.titolare.email]</strong></p>' },
	]
};

module.exports = (done) => {

	const PrivacyPoliciesItem = new PrivacyPolicies.model(updates.privacy_policies);
	PrivacyPoliciesItem.save((err, result) => {
		if (err) {
			return console.error(err);
		}

		const privacy_contents_updates = updates.privacy_contents.map(p => add_privacy_content(PrivacyPoliciesItem._id, p))
		return Promise.all(
			privacy_contents_updates
		).then(r => {
			return done()
		})
	})

};

function add_privacy_content (privacy_policy_id, privacy_content) {
	privacy_content.policy = privacy_policy_id;
	const PrivacyContentItem = new PrivacyContents.model(privacy_content);

	return PrivacyContentItem.save()

}
